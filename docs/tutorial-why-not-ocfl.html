<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Tutorial: why-not-ocfl</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="light" data-theme="light"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="xONXItpZP50NWGK1pLi2k"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Indexer.html">Indexer</a></div><div class="sidebar-section-children"><a href="Store.html">Store</a></div><div class="sidebar-section-children"><a href="Walker.html">Walker</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="c8tf9MNsQozEgLa1yv20I"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-why-not-ocfl.html">why-not-ocfl</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="pCA1IURSKzKykeQdQGFCA"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#Credentials">Credentials</a></div><div class="sidebar-section-children"><a href="global.html#Transfer">Transfer</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h2>why-not-ocfl</h2></header><article><ul><li><a href="#why-not-just-use-ocfl">Why not just use OCFL?</a></li><li><a href="#so-why-not-use-this-in-paradisec">So why not use this in PARADISEC?</a><ul><li><a href="#reason-1-to-not-use-ocfl---the-dual-storage-problem">Reason 1 to not use OCFL - the dual storage problem</a></li><li><a href="#reason-2-to-not-use-ocfl---the-data-migration-from-current-to-ocfl">Reason 2 to not use OCFL - the data migration from current to OCFL</a></li><li><a href="#reason-3-to-not-use-ocfl---the-infinite-version-problem">Reason 3 to not use OCFL - the infinite version problem</a><ul><li><a href="#metadata-changes">Metadata changes</a></li><li><a href="#linking-collections-to-items">Linking collections to items</a></li><li><a href="#mitigation-proposal-1---overarching-services">Mitigation proposal 1 - overarching services</a></li><li><a href="#mitigation-proposal-2---mutable-head">Mitigation proposal 2 - mutable head</a></li></ul></li><li><a href="#reason-4-to-not-use-ocfl---complexity">Reason 4 to not use OCFL - complexity</a></li><li><a href="#reason-5-to-not-use-ocfl---inflexibilty">Reason 5 to not use OCFL - inflexibilty</a></li><li><a href="#reason-6-to-not-use-ocfl---extracting-data">Reason 6 to not use OCFL - extracting data</a></li></ul></li><li><a href="#so-why-invent-nocfl">So why invent nocfl?</a><ul><li><a href="#requirements">Requirements</a></li><li><a href="#about-nocfl">About nocfl</a></li><li><a href="#whats-missing--wrong-with-this-implementation">What's missing / wrong with this implementation?</a></li><li><a href="#whats-good-about-this-implementation">What's good about this implementation?</a></li><li><a href="#if-you-read-nothing-else">If you read nothing else</a></li></ul></li></ul><p>Author: <a href="https://www.linkedin.com/in/marcolarosa/">Dr Marco La Rosa</a></p><h1 id="why-not-just-use-ocfl%3F">Why not just use OCFL?</h1><p>The <a href="https://ocfl.io/">Oxford Common File Layout (OCFL)</a> <code>specification describes an application-independent approach to the storage of digital information in a structured, transparent, and predictable manner. It is designed to promote long-term object management best practices within digital repositories.</code></p><p>There are a number of benefits articulated by the spec writers which can be seen on the website but the key question for this work is the ability to version objects; or not. In OCFL, versioning is a property of the object. That is, you can't just version some files in the object. Before diving into the details, let's see what an OCFL object with one version and one file (store.js) looks like:</p><pre class="prettyprint source"><code>│   └── my
│       └── Id
│           └── en
│               └── ti
│                   └── fi
│                       └── er
│                           ├── 0=ocfl_object_1.0
│                           ├── inventory.json
│                           ├── inventory.json.sha512
│                           └── v1
│                               ├── content
│                               │   ├── store.js
│                               ├── inventory.json
│                               └── inventory.json.sha512
</code></pre><p>For an object with identifier &quot;myIdentifier&quot; the path is generated by pairtreeing the identifier (breaking it into chunks of 2; ['my', 'Id', 'en', ...]). At the root of the entry there are 3 files (0=ocfl_object_1.0, inventory.json and inventory.json.sha512) and a folder <code>v1</code>. The v1 folder has two inventory related files (inventory.json and inventory.json.sha512) and a folder <code>content</code> where the actual file has been stored.</p><p>Putting aside the identifier to path mapping for the moment and focussing only on the structure of the object we see that for 1 file we have 5 autogenerated system files and two folders, with the file itself stored 3 levels deep in the object.</p><p>If we add another version of that file into the object we see:</p><pre class="prettyprint source"><code>│   └── my
│       └── Id
│           └── en
│               └── ti
│                   └── fi
│                       └── er
│                           ├── 0=ocfl_object_1.0
│                           ├── inventory.json
│                           ├── inventory.json.sha512
│                           ├── v1
│                           │   ├── content
│                           │   │   ├── store.js
│                           │   ├── inventory.json
│                           │   └── inventory.json.sha512
│                           └── v2
│                               ├── content
│                               │   └── store.js
│                               ├── inventory.json
│                               └── inventory.json.sha512
</code></pre><p>After adding a new version of the file <code>store.js</code> we can see an additional folder <code>v2</code> has been created and within it a <code>content</code> folder with the new version of the file and two more inventory files.</p><p>If we look at the inventory files we find:</p><ul><li>Version 1 Inventory</li></ul><pre class="prettyprint source"><code>{
  &quot;id&quot;: &quot;myIdentifier&quot;,
  &quot;type&quot;: &quot;https://ocfl.io/1.0/spec/#inventory&quot;,
  &quot;digestAlgorithm&quot;: &quot;sha512&quot;,
  &quot;head&quot;: &quot;v1&quot;,
  &quot;versions&quot;: {
    &quot;v1&quot;: {
      &quot;created&quot;: &quot;2022-08-27T05:55:18.886Z&quot;,
      &quot;state&quot;: {
        &quot;940c51e0499774bf2d41fb77aa74bf2550998dfd2fbd6b6cff722c491e94557d6783bf0e3efc8782a15cd2f2463eca2e3c0585607e5f040f56ef9b8633e2bdd6&quot;: [
          &quot;store.js&quot;
        ],
      }
    }
  },
  &quot;manifest&quot;: {
    &quot;940c51e0499774bf2d41fb77aa74bf2550998dfd2fbd6b6cff722c491e94557d6783bf0e3efc8782a15cd2f2463eca2e3c0585607e5f040f56ef9b8633e2bdd6&quot;: [
      &quot;v1/content/store.js&quot;
    ],
  }
}
</code></pre><ul><li>Version 2 Inventory</li></ul><pre class="prettyprint source"><code>{
  &quot;id&quot;: &quot;myIdentifier&quot;,
  &quot;type&quot;: &quot;https://ocfl.io/1.0/spec/#inventory&quot;,
  &quot;digestAlgorithm&quot;: &quot;sha512&quot;,
  &quot;head&quot;: &quot;v2&quot;,
  &quot;versions&quot;: {
    &quot;v1&quot;: {
      &quot;created&quot;: &quot;2022-08-27T05:55:18.886Z&quot;,
      &quot;state&quot;: {
        &quot;940c51e0499774bf2d41fb77aa74bf2550998dfd2fbd6b6cff722c491e94557d6783bf0e3efc8782a15cd2f2463eca2e3c0585607e5f040f56ef9b8633e2bdd6&quot;: [
          &quot;store.js&quot;
        ],
      }
    },
    &quot;v2&quot;: {
      &quot;created&quot;: &quot;2022-08-27T06:00:32.697Z&quot;,
      &quot;state&quot;: {
        &quot;169c851280855f7e467198df726345549858ae2ff51ca5db28b3b52f500fc3049ea18f5bfb08ac1712dd720f61275fed9b9e293911c5887e095136ddc188aa32&quot;: [
          &quot;store.js&quot;
        ],
      }
    }
  },
  &quot;manifest&quot;: {
    &quot;169c851280855f7e467198df726345549858ae2ff51ca5db28b3b52f500fc3049ea18f5bfb08ac1712dd720f61275fed9b9e293911c5887e095136ddc188aa32&quot;: [
      &quot;v2/content/store.js&quot;
    ],
  }
}
</code></pre><p>The inventory files provide some metadata about the content (the id and type), the digest algorithm used to checksum the files (sha512), the current version (head) and the file versions known to this object: v1 in the first and v1, v2 in the second.</p><p>For a truly archival system where all changes to a dataset need to be tracked and maintained this is clearly a very good specification. Not only do we have all versions of the data but we also have checkums for each file and a well defined folder structure. Whilst you wouldn't want to traverse this with a file browser, user facing tools could easily hide this complexity to show the user a <code>time machine</code> like view of the dataset.</p><p>Object paths are created deterministically from the identifier of the object. The specification talks about pairtreeing the identifier to ensure that paths are 'spread' across the filesystem (e.g. so you don't end up with 20000 entries in a folder). There are a number of extensions to the spec which discuss different methods to achieve this. Whether this is good or bad really depends on usage. For a human - it's bad. For tools, it doesn't matter how long or short those paths are because you never interact with them directly. One point to be made is that OCFL filesystems in Object stores (e.g. AWS S3) don't need this. Object stores are just key / value stores - the fully qualified filename is the key and the data is the value. The key points to the location of the data in the cloud somewhere. Whilst the browsers attached to object stores make it look like there are folders - they are not real folders. That means that pairtreeing is not actually needed when using object stores and just makes for more complexity in those environments.</p><h1 id="so-why-not-use-this-in-paradisec%3F">So why not use this in PARADISEC?</h1><p>PARADISEC (Pacific And Regional Archive for DIgital Sources in Endangered Cultures) curates digital material about small or endangered languages. PARADISEC is a repository for language data. As a live repository data coming in passes through a number of workflow stages before being made 'available' to the general public via the repository. That means the metadata in the repository can go through a number of revisions in addition to some of the files during their processing (e.g. packing the metadata into wav files).</p><h2 id="reason-1-to-not-use-ocfl---the-dual-storage-problem">Reason 1 to not use OCFL - the dual storage problem</h2><p>PARADISEC (as at this writing) has more than 180TB of data. As part of the application renewal project we were initially planning on provisioning a new data store where we would export the items from the live catalog as OCFL objects. Thinking about this some more we came across the dual storage problem. We would need 180TB (and growing by 1-2TB per week) on the live catalog server <strong>AND</strong> the OCFL filesystem. As a project that is self funded by small grants and in-kind contributions from our partner institutions, getting access to <code>2n</code> storage growing at the rate of 1-2TB per week was just not feasible; or for that matter realistic.</p><h2 id="reason-2-to-not-use-ocfl---the-data-migration-from-current-to-ocfl">Reason 2 to not use OCFL - the data migration from current to OCFL</h2><p>To mitigate the dual storage problem the obvious simple solution is to migrate the current datastore to an OCFL filesystem. Whilst technically possible, at 180TB and counting it would be a monumental undertaking. Furthermore, the existing catalog application (a monolithic Ruby on Rails (RoR) application) would immediately stop working as it's not OCFL aware. You could say that the catalog could be adapted but given the limited funding available, it would be an investment in a technology that is due to be deprecated and replaced.</p><h2 id="reason-3-to-not-use-ocfl---the-infinite-version-problem">Reason 3 to not use OCFL - the infinite version problem</h2><p>But let's say we did migrate to an OCFL filesystem and adapt the current RoR application to be OCFL aware.</p><h3 id="metadata-changes">Metadata changes</h3><p>The nature of OCFL means that any change to the data or metadata would result in a new version being stored in the object. Versioning new data makes total sense - it's a repository / archive after all. But versioning every single time the metadata changes? Add Person X as author. New version. Oops - I meant Person Y. New version. Nope - it was Person X. New version. You can see the problem.</p><h3 id="linking-collections-to-items">Linking collections to items</h3><p>In the current system retrieving a collection from the server provides a metadata file with links to the related items. Likewise, collecting an item provides links to the collection it belongs to. When using OCFL the workflow would look something like the following:</p><ol><li>create a new collection - version 1 of the object is stored</li><li>create a new item and associate it to the collection - version 2 of the collection is created because the metadata has been updated</li><li>create a new item and associate it to the collection - version 3 of the collection.... and so on</li></ol><h3 id="mitigation-proposal-1---overarching-services">Mitigation proposal 1 - overarching services</h3><p>The viewpoint of a colleague of mine is that items should declare their membership of a given collection but the collection itself doesn't need to have links to its associated items. In such a system, an index over the OCFL filesystem would create the associations from collection to related items thus mitigating the infinite version problem in this case.</p><p>A requirement of PARADISEC is that one should be able to retrieve an item or collection off disk and know the full state of that object with all associated metadata. Having a service on top precludes this ability. One can argue whether this is a relevant concern but my position is that if OCFL were more flexible and versioning was at the level of the file then this wouldn't be an issue. Content could be versioned and metadata could bypass the versioning. But this is not possible with OCFL.</p><h3 id="mitigation-proposal-2---mutable-head">Mitigation proposal 2 - mutable head</h3><p>A colleague has proposed developing an extension - the OCFL specification defines ways it can be extended - whereby there is a mutable head. Basically, versioning is turned off for an object. The folder would look as follows:</p><pre class="prettyprint source"><code>│   └── my
│       └── Id
│           └── en
│               └── ti
│                   └── fi
│                       └── er
│                           ├── 0=ocfl_object_1.0
│                           ├── inventory.json
│                           ├── inventory.json.sha512
│                           └── v1
│                               ├── content
│                               │   ├── store.js
│                               ├── inventory.json
│                               └── inventory.json.sha512
</code></pre><p>And adding a new version of our store file:</p><pre class="prettyprint source"><code>│   └── my
│       └── Id
│           └── en
│               └── ti
│                   └── fi
│                       └── er
│                           ├── 0=ocfl_object_1.0
│                           ├── inventory.json
│                           ├── inventory.json.sha512
│                           └── v1
│                               ├── content
│                               │   ├── store.js
│                               ├── inventory.json
│                               └── inventory.json.sha512
</code></pre><p>No change. We just keep writing to v1.</p><p>There are a few issues with this proposal.</p><ol><li>If a key part of the specification - versioning - is turned off then that suggests that the specification itself is not the correct solution for this problem.</li><li>This folder structure can't be used under the existing catalog application. We have the choice of running another datastore (the dual storage problem) or we turn off the catalog and eventually replace it with something that can talk OCFL or invest time and money in adapting the current app to support OCFL.</li><li>The presence of the v1 folder suggests there will be more versions. But if there isn't, then this is just extra complexity for no good reason. Note that the store file is 3 levels deep in the object with all of the OCFL object files.</li><li>complexity and inflexibility - as described following.</li></ol><h2 id="reason-4-to-not-use-ocfl---complexity">Reason 4 to not use OCFL - complexity</h2><p>As shown in the first section, an OCFL object is complex. That complexity is not necessarily a bad thing but anyone who has ever had to perform a data migration knows, complexity grows as the size of the data grows. At 180TB, migrating the PARADISEC repository to OCFL would not be trivial.</p><h2 id="reason-5-to-not-use-ocfl---inflexibilty">Reason 5 to not use OCFL - inflexibilty</h2><p>In PARADISEC we currently maintain file checksums and all the metadata in the database is written to disk in XML form. The idea is that if the service (ie the DB) ever goes away, the data would be still be safe on disk with all of its metadata. What it doesn't have is versioning. But versioning in the PARADISEC context does not need to be at the object level.</p><p>Consider a wav audio file recording of a native speaker. Perhaps the quality of the recording is not great so some post processing is done on the file to remove the noise. In the process most of the audio becomes clearer but some sections are adversely affected. In this case you would likely want to keep two versions of that file: the original unmanipulated version and the revised, cleaned up version.</p><p>Now consider an image of a manuscript. Perhaps the imaging process done by the grad student is not very good so in the next grant some money is available for professionals to re-image the manuscript. Do you need to keep the two versions? The first which has bad contrast and is difficult to read and the professional one that is clear and high definition? I would argue likely not.</p><p>With OCFL it's not possible to choose to version one file and not another. For metadata that is actively being revised (as discussed above) this is an even greater problem.</p><h2 id="reason-6-to-not-use-ocfl---extracting-data">Reason 6 to not use OCFL - extracting data</h2><p>As you can see from the structure, to get the current version of the data inside an object you would traverse forwards through the versions collecting all of the files; with later versions of the file overwriting the earlier versions. Whilst possible to do with a simple file browser, it would be complex. A mitigation strategy is the development of a tool that given an object id, would <code>export</code> the object data to some location. (Whether anyone should be accessing a repository data store via a file browser is outside the scope of this discussion. I would say not but sometimes you get told to allow that...)</p><h1 id="so-why-invent-nocfl%3F">So why invent nocfl?</h1><p><code>nocfl</code> (not OCFL - this library) is not a new invention. Rather, it's a library which codifies the requirements put forward by PARADISEC and used in their repository for close to 20 years. Whilst these requirements might not be suitable for all repositories, they have worked exceedingly well in the PARADISEC context and have been battle tested.</p><h2 id="requirements">Requirements</h2><ol><li>Objects in the repository must be named as per the following regular expression: <code>[a-z,A-Z,0-9][a-z,A-Z,0-9,_]+</code><ol><li>The identifier must start with a letter (lower or uppercase) or a number</li><li>It must have at least 1 letter, number of underscore following</li><li>It cannot use any other characters</li></ol></li><li>Paths in paradisec are as follows:<ol><li>Collection: <code>/${collection identifier}</code></li><li>Item: <code>/${collection identifier}/${item identifier}</code></li></ol></li></ol><h2 id="about-nocfl">About nocfl</h2><ol><li>The library is object storage native. That means it works with AWS s3 or implementations that support that API: e.g. openstack storage, MinIO and others.</li><li>Objects must meet the naming requirements defined above.</li><li>Paths are created as follows: <code>/{domain}/${class}/${identifier first n letters}/${identifier}</code><ol><li>e.g. /paradisec.org.au/collection/m/myCollection</li><li>The <code>identifier first n letters</code> is called the splay property and it's defined per object in the store. If this library develops the ability to use filesystem backends, it will become important to <code>spread</code> content out across the filesystem. For as long as the library only supports Object stores it's not actually required for the reasons explained earlier.</li></ol></li><li>The library automatically installs a <a href="https://www.researchobject.org/ro-crate/">Research Object Crate</a> metadata file and populates it as data is added to / removed from the store.</li><li>The library automtically manages an inventory file with SHA512 hashes. This is not configurable by the user. The probably of a collision (that two pieces of data or files would produce the same hash) is <a href="https://en.wikipedia.org/wiki/Birthday_problem#Probability_table">vanishingly small</a>.</li><li>The library supports per file versioning. Let me state this again. It supports <code>per file versioning</code>. An explanation of why this is useful is above.</li></ol><h2 id="what's-missing-%2F-wrong-with-this-implementation%3F">What's missing / wrong with this implementation?</h2><p>For a start, the path scheme it creates <code>/{domain}/${class}/${identifier first letter}/${identifier}</code> is <strong>NOT</strong> consistent with the PARADISEC scheme: <code>/{collection id}/{item id}</code>. At the time of writing this we are in discussions with our partners to see if they want to move to object storage or continue with the NFS filesystem store. If they choose to continue with NFS on disk then two things need to happen:</p><ol><li>This library needs to be adapted to work with a local filesystem - easy.</li><li>An extra property <code>itemPath</code> is to be added to the Store constructor which would take in the path to use rather than assembling it from the domain, class and id - trivial.</li></ol><h2 id="what's-good-about-this-implementation%3F">What's good about this implementation?</h2><p>The current file system layout of PARADISEC looks like (using an item example):</p><pre class="prettyprint source"><code>./{collection id}/{item id}
│      ├── {metadata.xml}
│      ├── file1.wav
│      ├── file2.wav
│      ├── file3.mp3
│      ├── ... etc ...
</code></pre><p>After overlaying nocfl:</p><pre class="prettyprint source"><code>./{collection id}/{item id}
│      ├── nocfl.identifier.json
│      ├── nocfl.inventory.json
│      ├── ro-crate-metadata.json
│      ├── {metadata.xml}
│      ├── file1.wav
│      ├── file2.wav
│      ├── file3.mp3
│      ├── ... etc ...
</code></pre><p>As you can see, it's the same as the existing layout but with a few extra files. This means we can convert the existing filesytem to be a nocfl filesystem and the existing application <code>would keep working</code>; just that there would be a few extra files in the UI (which we could filter in the app with a small change to the code rather than the much larger addition of OCFL capability.)</p><p>Further, the structure is much simpler than an OCFL based filesystem.</p><p>And per file versioning?</p><pre class="prettyprint source"><code>./{collection id}/{item id}
│      ├── nocfl.identifier.json
│      ├── nocfl.inventory.json
│      ├── ro-crate-metadata.json
│      ├── {metadata.xml}
│      ├── file1.wav
│      ├── file1.v${DATE as ISO String}.wav
│      ├── file1.v${DATE as ISO String}.wav
│      ├── file2.wav
│      ├── file3.mp3
│      ├── ... etc ...
</code></pre><p>Again, the current application would keep working - it would just see a few extra files.</p><p>Just to explain, versioning is to be thought of as follows:</p><ul><li>file1.wav --&gt; the current version</li><li>file1.v${DATE as ISO String}.wav --&gt; version until that point in time</li></ul><p>Finally, converting a PARADISEC object to nocfl would not drastically alter the backup of that data. A few more files would be added. It would not be a wholesale update of the whole system which at 180TB and growing is less than ideal.</p><h2 id="if-you-read-nothing-else">If you read nothing else</h2><ol><li><p>It's simpler than OCFL.</p></li><li><p>It can overlay existing filesystem structures without change.</p></li><li><p>It's an evolution of a system that has been battle tested for almost 20 years.</p></li><li><p>No additional services are required to make sense of the data - a file browser is all that is required.</p></li><li><p>The simplicity of the design means it can be easily managed via a file browser.</p></li><li><p>Extracting data from the filesystem doesn't require custom tools that understand OCFL - a file browser is all that is required.</p></li><li><p>It supports per file versioning.</p></li><li><p>It automatically manages metadata (RO Crate Metadata) and file checksums - both required for good practice.</p></li></ol></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="xONXItpZP50NWGK1pLi2k"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Indexer.html">Indexer</a></div><div class="sidebar-section-children"><a href="Store.html">Store</a></div><div class="sidebar-section-children"><a href="Walker.html">Walker</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="c8tf9MNsQozEgLa1yv20I"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-why-not-ocfl.html">why-not-ocfl</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="pCA1IURSKzKykeQdQGFCA"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#Credentials">Credentials</a></div><div class="sidebar-section-children"><a href="global.html#Transfer">Transfer</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>